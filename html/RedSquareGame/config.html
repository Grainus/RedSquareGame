<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>RedSquareGame.config API documentation</title>
<meta name="description" content="Module de configuration optimisé …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>RedSquareGame.config</code></h1>
</header>
<section id="section-intro">
<p>Module de configuration optimisé.</p>
<p>Ce module permet de lire et de sauvegarder une configuration en format
JSON. Il nécessite un fichier représentant les valeurs par défaut nommé
<code>defaults.json</code>. Le fichier de sauvegarde (par défaut <code>settings.json</code>)
est optimisé pour n'inclure que les valeurs qui diffèrent de celles par
défaut. Plusieurs méthodes permettant de manipuler des dictionnaires
imbriqués sont aussi présentes.</p>
<h2 id="example">Example</h2>
<p>config = Config.get_instance()
config["Game"]["Difficulty"] = "HARD"
config.save(indent=4)</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (c) 2022 Grainus
#
# All rights reserved.
&#34;&#34;&#34;Module de configuration optimisé.

Ce module permet de lire et de sauvegarder une configuration en format
JSON. Il nécessite un fichier représentant les valeurs par défaut nommé
`defaults.json`. Le fichier de sauvegarde (par défaut `settings.json`)
est optimisé pour n&#39;inclure que les valeurs qui diffèrent de celles par
défaut. Plusieurs méthodes permettant de manipuler des dictionnaires
imbriqués sont aussi présentes.

Example:

  config = Config.get_instance()
  config[&#34;Game&#34;][&#34;Difficulty&#34;] = &#34;HARD&#34;
  config.save(indent=4)
&#34;&#34;&#34;

from __future__ import annotations
from typing import Sequence, Self, TextIO, Any

from functools import reduce
import json
import os

__docformat__ = &#34;google&#34;


class Multiton(type):
    &#34;&#34;&#34;Permet d&#39;initialiser l&#39;objet une seule fois par nom.

    Une fois un objet initialisé, une référence est créée avec le nom
    donné. Si on essaie d&#39;initialiser un objet de la même classe avec le
    même nom, la référence est retournée et aucun nouveau objet n&#39;est
    créé. Un même nom peut être utilisé par plusieurs classes
    différentes sans problème.

    Demander un objet déja créé a une complexité de O(1).
    &#34;&#34;&#34;
    _instances: dict[tuple[type, str], Any] = {}

    def __call__(cls, name: str, *args, **kwargs):
        key = (cls, name)
        if key not in Multiton._instances:
            Multiton._instances[key] = (
                    super().__call__(name, *args, **kwargs)
            )
        return Multiton._instances[key]


class Config(metaclass=Multiton):
    &#34;&#34;&#34;Classe permettant d&#39;accéder aux configurations JSON.

    La configuration gardée en memoire représente la configuration
    complète des valeurs par défaut et des modifications. Pour accéder
    aux valeurs, l&#39;utilisation de crochets `[]` est la méthode préférée.

    Note:
        Pour obtenir un objet Config, la méthode `Config.get_instance`
        doit être utilisée à la place de la méthode d&#39;initialisation.
    &#34;&#34;&#34;
    def __init__(self, name):
        &#34;&#34;&#34;Méthode interne. Voir `Config.get_instance`.&#34;&#34;&#34;
        currentdir = os.path.dirname(__file__)
        configdir = os.path.join(currentdir, &#34;Data&#34;)
        self.filepath = os.path.join(configdir, name + &#39;.json&#39;)

        # Charge les valeurs par défaut d&#39;abord
        self.config: dict[str, Any] = {}
        if name != &#34;defaults&#34;:
            defaults = Config.get_instance(&#34;defaults&#34;).filepath
            with open(defaults) as file:
                self.config = json.load(file)
        try:
            with open(self.filepath) as file:
                deep_update(self.config, json.load(file))
        except (OSError, json.JSONDecodeError):
            with open(self.filepath, &#39;a&#39;) as file:
                file.write(&#39;{}&#39;)

    @classmethod
    def get_instance(cls, name: str = &#34;settings&#34;) -&gt; Self:
        &#34;&#34;&#34;Retourne une instance de Config pour le fichier spécifié.

        Args:
            name: Le nom du fichier de configuration à ouvrir.
              Defaults to &#34;settings&#34;.

        Returns:
            Si le fichier spécifié n&#39;a pas encore été ouvert, une
            nouvelle instance de Config. Sinon, une référence à l&#39;objet
            existant.
        &#34;&#34;&#34;
        return cls(name)

    def __getitem__(self, __key: str) -&gt; Any | dict[str, Any]:
        &#34;&#34;&#34;Accès directe au dictionnaire des configurations.&#34;&#34;&#34;
        return self.config[__key]

    def save(self, file: TextIO | str | None = None, **kwargs) -&gt; None:
        &#34;&#34;&#34;Sauvegarde la configuration optimisée pour la taille dans un
        fichier.

        Args:
            file: Le fichier à utiliser pour la sauvegarde. Peut être un
              file-like ou un chemin. Si la valeur n&#39;est pas donnée, le
              fichier utilisé lors de l&#39;initialisation est pris.
            **kwargs: Arguments passés à `json.dump`.
        &#34;&#34;&#34;
        defaults = Config.get_instance(&#39;defaults&#39;).config
        diffs = deep_compare(self.config, defaults)
        file = file if file is not None else self.filepath
        if not isinstance(file, str):
            json.dump(diffs, file, **kwargs)
        else:
            with open(file, &#39;w&#39;) as out:
                json.dump(diffs, out, **kwargs)


def deep_get(dct: dict, keys, *_keys: Any) -&gt; Any | None:
    &#34;&#34;&#34;
    Retourne un élément dans un dictionnaire imbriqué avec un nombre
    variable de clés. Si la clé est inexistante, retourne None.

    Args:
        dct: Le dictionnaire à chercher.
        keys: Une séquence de clés, ou une clé unique.
        _keys: Un nombre variable de clés.

    Example:
        mydict = {&#34;People&#34;: {&#34;John&#34;: {&#34;Age&#34;: 30}, &#34;Marie&#34;: {&#34;Age&#34;: 20}}}

        deep_get(mydict, &#34;People&#34;, &#34;John&#34;, &#34;Age&#34;)  # 30
        deep_get(mydict, (&#34;People&#34;, &#34;John&#34;, &#34;Age&#34;))  # 30

        marie = (&#34;People&#34;, &#34;Marie&#34;)
        deep_get(mydict, marie, &#34;Age&#34;)  # 20
    &#34;&#34;&#34;
    if isinstance(keys, Sequence) and not isinstance(keys, str):
        keys = (*keys, *_keys)
    else:
        keys = (keys, *_keys)
    # Retourne None si valeur non trouvée pour émuler dict.get
    return reduce(
        lambda d, key: d.get(key) if d else None, keys, dct  # type: ignore
    )


def deep_set(dct: dict, keys: Sequence, value: Any) -&gt; None:
    &#34;&#34;&#34;Modifie la valeur d&#39;un dictionnaire imbriqué à une clé donnée.

    Si une clé est manquante, un nouveau dictionnaire est créé à chaque
    niveau pour insérer la valeur.

    Args:
        dct: Le dictionnaire à modifier.
        keys: Une séquence de clés jusqu&#39;à la valeur.
        value: La valeur à mettre dans le dictionnaire.
    &#34;&#34;&#34;
    _dict = dct
    for key in keys[:-1]:
        if key not in _dict:
            _dict[key] = {}
        _dict = _dict[key]
    _dict[keys[-1]] = value


def deep_update(dct: dict, new: dict) -&gt; None:
    &#34;&#34;&#34;Implémentation de `dict.update` qui fonctionne sur les
    dictionnaires imbriqués.

    Modifie le `dct` de manière à ce que tous les éléments de `new` y
    soient présents. Si une clé est présente dans les deux
    dictionnaires avec des valeurs différentes, la valeur dans `new` est
    utilisée. Si `dct` n&#39;a aucun élément inexistants dans `new`, les
    deux dictionnaires seront identiques.

    Args:
        dct: Le dictionnaire à modifier.
        new: Le dictionnaire possédant les clés à ajouter ou modifier.
    &#34;&#34;&#34;
    # Afin d&#39;éviter une solution récursive
    dict.update
    _stack: list[tuple[tuple[Any, ...], dict[Any, Any]]] = [((), new)]
    while _stack:
        keystack, subdict = _stack.pop(0)
        for key, val in subdict.items():
            _keys = (*keystack, key)
            if isinstance(val, dict):
                _stack.append((_keys, val))
            else:
                deep_set(dct, _keys, val)


def deep_compare(dct: dict, defaults: dict) -&gt; dict:
    &#34;&#34;&#34;Calcule la différence entre deux dictionaires.

    Returns:
        Un nouveau dictionaire D tel que `deep_update(dct, D)`
          produise un dictionaire identique à `dct` si `defaults` ne
          possède aucune clé inexistante dans `dct`.
    &#34;&#34;&#34;
    # Afin d&#39;éviter une solution récursive
    _stack: list[tuple[tuple[Any, ...], dict[Any, Any]]] = [((), dct)]
    _diffs: dict[Any, Any] = {}
    while _stack:
        keystack, subdict = _stack.pop(0)
        for key, val in subdict.items():
            _keys = (*keystack, key)
            if isinstance(val, dict):
                _stack.append((_keys, val))
            elif val != deep_get(defaults, _keys):
                deep_set(_diffs, _keys, val)
    return _diffs


def test_diff_save():
    config = Config.get_instance()
    default = Config.get_instance(&#39;defaults&#39;)
    cfgcolor = config[&#34;Game&#34;][&#34;Color&#34;]
    defcolor = default[&#34;Game&#34;][&#34;Color&#34;]

    cfgcolor[&#34;Outline&#34;] = defcolor[&#34;Outline&#34;] + &#34;_&#34;  # Force valeur custom
    config.save()
    size1 = os.stat(config.filepath).st_size

    cfgcolor[&#34;Outline&#34;] = defcolor[&#34;Outline&#34;]  # Remet le defaut
    config.save()
    size2 = os.stat(config.filepath).st_size

    # Le fichier ne sauvegarde que les différences. Les valeurs par
    # défaut créent donc un plus petit fichier.
    assert size2 &lt; size1


if __name__ == &#34;__main__&#34;:
    test_diff_save()
    print(&#34;All test passed&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="RedSquareGame.config.deep_compare"><code class="name flex">
<span>def <span class="ident">deep_compare</span></span>(<span>dct: dict, defaults: dict) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Calcule la différence entre deux dictionaires.</p>
<h2 id="returns">Returns</h2>
<p>Un nouveau dictionaire D tel que <code><a title="RedSquareGame.config.deep_update" href="#RedSquareGame.config.deep_update">deep_update()</a>(dct, D)</code>
produise un dictionaire identique à <code>dct</code> si <code>defaults</code> ne
possède aucune clé inexistante dans <code>dct</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deep_compare(dct: dict, defaults: dict) -&gt; dict:
    &#34;&#34;&#34;Calcule la différence entre deux dictionaires.

    Returns:
        Un nouveau dictionaire D tel que `deep_update(dct, D)`
          produise un dictionaire identique à `dct` si `defaults` ne
          possède aucune clé inexistante dans `dct`.
    &#34;&#34;&#34;
    # Afin d&#39;éviter une solution récursive
    _stack: list[tuple[tuple[Any, ...], dict[Any, Any]]] = [((), dct)]
    _diffs: dict[Any, Any] = {}
    while _stack:
        keystack, subdict = _stack.pop(0)
        for key, val in subdict.items():
            _keys = (*keystack, key)
            if isinstance(val, dict):
                _stack.append((_keys, val))
            elif val != deep_get(defaults, _keys):
                deep_set(_diffs, _keys, val)
    return _diffs</code></pre>
</details>
</dd>
<dt id="RedSquareGame.config.deep_get"><code class="name flex">
<span>def <span class="ident">deep_get</span></span>(<span>dct: dict, keys, *_keys: Any) ‑> typing.Any | None</span>
</code></dt>
<dd>
<div class="desc"><p>Retourne un élément dans un dictionnaire imbriqué avec un nombre
variable de clés. Si la clé est inexistante, retourne None.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>dct</code></strong></dt>
<dd>Le dictionnaire à chercher.</dd>
<dt><strong><code>keys</code></strong></dt>
<dd>Une séquence de clés, ou une clé unique.</dd>
<dt><strong><code>_keys</code></strong></dt>
<dd>Un nombre variable de clés.</dd>
</dl>
<h2 id="example">Example</h2>
<p>mydict = {"People": {"John": {"Age": 30}, "Marie": {"Age": 20}}}</p>
<p>deep_get(mydict, "People", "John", "Age")
# 30
deep_get(mydict, ("People", "John", "Age"))
# 30</p>
<p>marie = ("People", "Marie")
deep_get(mydict, marie, "Age")
# 20</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deep_get(dct: dict, keys, *_keys: Any) -&gt; Any | None:
    &#34;&#34;&#34;
    Retourne un élément dans un dictionnaire imbriqué avec un nombre
    variable de clés. Si la clé est inexistante, retourne None.

    Args:
        dct: Le dictionnaire à chercher.
        keys: Une séquence de clés, ou une clé unique.
        _keys: Un nombre variable de clés.

    Example:
        mydict = {&#34;People&#34;: {&#34;John&#34;: {&#34;Age&#34;: 30}, &#34;Marie&#34;: {&#34;Age&#34;: 20}}}

        deep_get(mydict, &#34;People&#34;, &#34;John&#34;, &#34;Age&#34;)  # 30
        deep_get(mydict, (&#34;People&#34;, &#34;John&#34;, &#34;Age&#34;))  # 30

        marie = (&#34;People&#34;, &#34;Marie&#34;)
        deep_get(mydict, marie, &#34;Age&#34;)  # 20
    &#34;&#34;&#34;
    if isinstance(keys, Sequence) and not isinstance(keys, str):
        keys = (*keys, *_keys)
    else:
        keys = (keys, *_keys)
    # Retourne None si valeur non trouvée pour émuler dict.get
    return reduce(
        lambda d, key: d.get(key) if d else None, keys, dct  # type: ignore
    )</code></pre>
</details>
</dd>
<dt id="RedSquareGame.config.deep_set"><code class="name flex">
<span>def <span class="ident">deep_set</span></span>(<span>dct: dict, keys: Sequence, value: Any) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Modifie la valeur d'un dictionnaire imbriqué à une clé donnée.</p>
<p>Si une clé est manquante, un nouveau dictionnaire est créé à chaque
niveau pour insérer la valeur.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>dct</code></strong></dt>
<dd>Le dictionnaire à modifier.</dd>
<dt><strong><code>keys</code></strong></dt>
<dd>Une séquence de clés jusqu'à la valeur.</dd>
<dt><strong><code>value</code></strong></dt>
<dd>La valeur à mettre dans le dictionnaire.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deep_set(dct: dict, keys: Sequence, value: Any) -&gt; None:
    &#34;&#34;&#34;Modifie la valeur d&#39;un dictionnaire imbriqué à une clé donnée.

    Si une clé est manquante, un nouveau dictionnaire est créé à chaque
    niveau pour insérer la valeur.

    Args:
        dct: Le dictionnaire à modifier.
        keys: Une séquence de clés jusqu&#39;à la valeur.
        value: La valeur à mettre dans le dictionnaire.
    &#34;&#34;&#34;
    _dict = dct
    for key in keys[:-1]:
        if key not in _dict:
            _dict[key] = {}
        _dict = _dict[key]
    _dict[keys[-1]] = value</code></pre>
</details>
</dd>
<dt id="RedSquareGame.config.deep_update"><code class="name flex">
<span>def <span class="ident">deep_update</span></span>(<span>dct: dict, new: dict) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Implémentation de <code>dict.update</code> qui fonctionne sur les
dictionnaires imbriqués.</p>
<p>Modifie le <code>dct</code> de manière à ce que tous les éléments de <code>new</code> y
soient présents. Si une clé est présente dans les deux
dictionnaires avec des valeurs différentes, la valeur dans <code>new</code> est
utilisée. Si <code>dct</code> n'a aucun élément inexistants dans <code>new</code>, les
deux dictionnaires seront identiques.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>dct</code></strong></dt>
<dd>Le dictionnaire à modifier.</dd>
<dt><strong><code>new</code></strong></dt>
<dd>Le dictionnaire possédant les clés à ajouter ou modifier.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deep_update(dct: dict, new: dict) -&gt; None:
    &#34;&#34;&#34;Implémentation de `dict.update` qui fonctionne sur les
    dictionnaires imbriqués.

    Modifie le `dct` de manière à ce que tous les éléments de `new` y
    soient présents. Si une clé est présente dans les deux
    dictionnaires avec des valeurs différentes, la valeur dans `new` est
    utilisée. Si `dct` n&#39;a aucun élément inexistants dans `new`, les
    deux dictionnaires seront identiques.

    Args:
        dct: Le dictionnaire à modifier.
        new: Le dictionnaire possédant les clés à ajouter ou modifier.
    &#34;&#34;&#34;
    # Afin d&#39;éviter une solution récursive
    dict.update
    _stack: list[tuple[tuple[Any, ...], dict[Any, Any]]] = [((), new)]
    while _stack:
        keystack, subdict = _stack.pop(0)
        for key, val in subdict.items():
            _keys = (*keystack, key)
            if isinstance(val, dict):
                _stack.append((_keys, val))
            else:
                deep_set(dct, _keys, val)</code></pre>
</details>
</dd>
<dt id="RedSquareGame.config.test_diff_save"><code class="name flex">
<span>def <span class="ident">test_diff_save</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_diff_save():
    config = Config.get_instance()
    default = Config.get_instance(&#39;defaults&#39;)
    cfgcolor = config[&#34;Game&#34;][&#34;Color&#34;]
    defcolor = default[&#34;Game&#34;][&#34;Color&#34;]

    cfgcolor[&#34;Outline&#34;] = defcolor[&#34;Outline&#34;] + &#34;_&#34;  # Force valeur custom
    config.save()
    size1 = os.stat(config.filepath).st_size

    cfgcolor[&#34;Outline&#34;] = defcolor[&#34;Outline&#34;]  # Remet le defaut
    config.save()
    size2 = os.stat(config.filepath).st_size

    # Le fichier ne sauvegarde que les différences. Les valeurs par
    # défaut créent donc un plus petit fichier.
    assert size2 &lt; size1</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="RedSquareGame.config.Config"><code class="flex name class">
<span>class <span class="ident">Config</span></span>
<span>(</span><span>name)</span>
</code></dt>
<dd>
<div class="desc"><p>Classe permettant d'accéder aux configurations JSON.</p>
<p>La configuration gardée en memoire représente la configuration
complète des valeurs par défaut et des modifications. Pour accéder
aux valeurs, l'utilisation de crochets <code>[]</code> est la méthode préférée.</p>
<h2 id="note">Note</h2>
<p>Pour obtenir un objet Config, la méthode <code><a title="RedSquareGame.config.Config.get_instance" href="#RedSquareGame.config.Config.get_instance">Config.get_instance()</a></code>
doit être utilisée à la place de la méthode d'initialisation.</p>
<p>Méthode interne. Voir <code><a title="RedSquareGame.config.Config.get_instance" href="#RedSquareGame.config.Config.get_instance">Config.get_instance()</a></code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Config(metaclass=Multiton):
    &#34;&#34;&#34;Classe permettant d&#39;accéder aux configurations JSON.

    La configuration gardée en memoire représente la configuration
    complète des valeurs par défaut et des modifications. Pour accéder
    aux valeurs, l&#39;utilisation de crochets `[]` est la méthode préférée.

    Note:
        Pour obtenir un objet Config, la méthode `Config.get_instance`
        doit être utilisée à la place de la méthode d&#39;initialisation.
    &#34;&#34;&#34;
    def __init__(self, name):
        &#34;&#34;&#34;Méthode interne. Voir `Config.get_instance`.&#34;&#34;&#34;
        currentdir = os.path.dirname(__file__)
        configdir = os.path.join(currentdir, &#34;Data&#34;)
        self.filepath = os.path.join(configdir, name + &#39;.json&#39;)

        # Charge les valeurs par défaut d&#39;abord
        self.config: dict[str, Any] = {}
        if name != &#34;defaults&#34;:
            defaults = Config.get_instance(&#34;defaults&#34;).filepath
            with open(defaults) as file:
                self.config = json.load(file)
        try:
            with open(self.filepath) as file:
                deep_update(self.config, json.load(file))
        except (OSError, json.JSONDecodeError):
            with open(self.filepath, &#39;a&#39;) as file:
                file.write(&#39;{}&#39;)

    @classmethod
    def get_instance(cls, name: str = &#34;settings&#34;) -&gt; Self:
        &#34;&#34;&#34;Retourne une instance de Config pour le fichier spécifié.

        Args:
            name: Le nom du fichier de configuration à ouvrir.
              Defaults to &#34;settings&#34;.

        Returns:
            Si le fichier spécifié n&#39;a pas encore été ouvert, une
            nouvelle instance de Config. Sinon, une référence à l&#39;objet
            existant.
        &#34;&#34;&#34;
        return cls(name)

    def __getitem__(self, __key: str) -&gt; Any | dict[str, Any]:
        &#34;&#34;&#34;Accès directe au dictionnaire des configurations.&#34;&#34;&#34;
        return self.config[__key]

    def save(self, file: TextIO | str | None = None, **kwargs) -&gt; None:
        &#34;&#34;&#34;Sauvegarde la configuration optimisée pour la taille dans un
        fichier.

        Args:
            file: Le fichier à utiliser pour la sauvegarde. Peut être un
              file-like ou un chemin. Si la valeur n&#39;est pas donnée, le
              fichier utilisé lors de l&#39;initialisation est pris.
            **kwargs: Arguments passés à `json.dump`.
        &#34;&#34;&#34;
        defaults = Config.get_instance(&#39;defaults&#39;).config
        diffs = deep_compare(self.config, defaults)
        file = file if file is not None else self.filepath
        if not isinstance(file, str):
            json.dump(diffs, file, **kwargs)
        else:
            with open(file, &#39;w&#39;) as out:
                json.dump(diffs, out, **kwargs)</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="RedSquareGame.config.Config.get_instance"><code class="name flex">
<span>def <span class="ident">get_instance</span></span>(<span>name: str = 'settings') ‑> Self</span>
</code></dt>
<dd>
<div class="desc"><p>Retourne une instance de Config pour le fichier spécifié.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>name</code></strong></dt>
<dd>Le nom du fichier de configuration à ouvrir.
Defaults to "settings".</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Si le fichier spécifié n'a pas encore été ouvert, une
nouvelle instance de Config. Sinon, une référence à l'objet
existant.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def get_instance(cls, name: str = &#34;settings&#34;) -&gt; Self:
    &#34;&#34;&#34;Retourne une instance de Config pour le fichier spécifié.

    Args:
        name: Le nom du fichier de configuration à ouvrir.
          Defaults to &#34;settings&#34;.

    Returns:
        Si le fichier spécifié n&#39;a pas encore été ouvert, une
        nouvelle instance de Config. Sinon, une référence à l&#39;objet
        existant.
    &#34;&#34;&#34;
    return cls(name)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="RedSquareGame.config.Config.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self, file: TextIO | str | None = None, **kwargs) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Sauvegarde la configuration optimisée pour la taille dans un
fichier.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file</code></strong></dt>
<dd>Le fichier à utiliser pour la sauvegarde. Peut être un
file-like ou un chemin. Si la valeur n'est pas donnée, le
fichier utilisé lors de l'initialisation est pris.</dd>
<dt><strong><code>**kwargs</code></strong></dt>
<dd>Arguments passés à <code>json.dump</code>.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save(self, file: TextIO | str | None = None, **kwargs) -&gt; None:
    &#34;&#34;&#34;Sauvegarde la configuration optimisée pour la taille dans un
    fichier.

    Args:
        file: Le fichier à utiliser pour la sauvegarde. Peut être un
          file-like ou un chemin. Si la valeur n&#39;est pas donnée, le
          fichier utilisé lors de l&#39;initialisation est pris.
        **kwargs: Arguments passés à `json.dump`.
    &#34;&#34;&#34;
    defaults = Config.get_instance(&#39;defaults&#39;).config
    diffs = deep_compare(self.config, defaults)
    file = file if file is not None else self.filepath
    if not isinstance(file, str):
        json.dump(diffs, file, **kwargs)
    else:
        with open(file, &#39;w&#39;) as out:
            json.dump(diffs, out, **kwargs)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="RedSquareGame.config.Multiton"><code class="flex name class">
<span>class <span class="ident">Multiton</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Permet d'initialiser l'objet une seule fois par nom.</p>
<p>Une fois un objet initialisé, une référence est créée avec le nom
donné. Si on essaie d'initialiser un objet de la même classe avec le
même nom, la référence est retournée et aucun nouveau objet n'est
créé. Un même nom peut être utilisé par plusieurs classes
différentes sans problème.</p>
<p>Demander un objet déja créé a une complexité de O(1).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Multiton(type):
    &#34;&#34;&#34;Permet d&#39;initialiser l&#39;objet une seule fois par nom.

    Une fois un objet initialisé, une référence est créée avec le nom
    donné. Si on essaie d&#39;initialiser un objet de la même classe avec le
    même nom, la référence est retournée et aucun nouveau objet n&#39;est
    créé. Un même nom peut être utilisé par plusieurs classes
    différentes sans problème.

    Demander un objet déja créé a une complexité de O(1).
    &#34;&#34;&#34;
    _instances: dict[tuple[type, str], Any] = {}

    def __call__(cls, name: str, *args, **kwargs):
        key = (cls, name)
        if key not in Multiton._instances:
            Multiton._instances[key] = (
                    super().__call__(name, *args, **kwargs)
            )
        return Multiton._instances[key]</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.type</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="RedSquareGame" href="index.html">RedSquareGame</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="RedSquareGame.config.deep_compare" href="#RedSquareGame.config.deep_compare">deep_compare</a></code></li>
<li><code><a title="RedSquareGame.config.deep_get" href="#RedSquareGame.config.deep_get">deep_get</a></code></li>
<li><code><a title="RedSquareGame.config.deep_set" href="#RedSquareGame.config.deep_set">deep_set</a></code></li>
<li><code><a title="RedSquareGame.config.deep_update" href="#RedSquareGame.config.deep_update">deep_update</a></code></li>
<li><code><a title="RedSquareGame.config.test_diff_save" href="#RedSquareGame.config.test_diff_save">test_diff_save</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="RedSquareGame.config.Config" href="#RedSquareGame.config.Config">Config</a></code></h4>
<ul class="">
<li><code><a title="RedSquareGame.config.Config.get_instance" href="#RedSquareGame.config.Config.get_instance">get_instance</a></code></li>
<li><code><a title="RedSquareGame.config.Config.save" href="#RedSquareGame.config.Config.save">save</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="RedSquareGame.config.Multiton" href="#RedSquareGame.config.Multiton">Multiton</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>